// ุชุฃูุฏ ุฃู ูุฐุง ุงูููู ูุง ูููู ุงุณุชูุฑุงุฏู ูู ุฌุงูุจ ุงูุนููู (Client-Side)
import 'server-only';

// ุงุณุชูุฑุงุฏ ุงูุฏูุงู ูุงููุญุฏุงุช ุงูุถุฑูุฑูุฉ
import { createTRPCOptionsProxy } from '@trpc/tanstack-react-query';
import { cache } from 'react';
import { createTRPCContext } from './init';
import { makeQueryClient } from './query-client';
import { appRouter } from './routers/_app';

import { createTRPCClient, httpLink } from '@trpc/client';

// ููู: ุฅูุดุงุก getter ูุณุชูุฑ ูุนููู ุงูุงุณุชุนูุงูุงุช
// ุงูุฐู ุณูุนูุฏ ููุณ ุงูุนููู ุฎูุงู ููุณ ุงูุทูุจ (Request)
export const getQueryClient = cache(makeQueryClient);

// ุฅูุดุงุก ูููู (proxy) ุฎูุงุฑุงุช tRPC ููุงุณุชุฎุฏุงู ุนูู ุงูุฎุงุฏู
export const trpc = createTRPCOptionsProxy({
  ctx: createTRPCContext,      // ุฏุงูุฉ ูุฅูุดุงุก ุณูุงู tRPC
  router: appRouter,           // ุงูุฑุงูุชุฑ ุงูุฑุฆูุณู ููุชุทุจูู
  queryClient: getQueryClient, // ุนููู ุงูุงุณุชุนูุงูุงุช (ูุชู ูุดุงุฑูุชู ุฎูุงู ููุณ ุงูุทูุจ)
});
export const caller = appRouter.createCaller(createTRPCContext);

// ุฅุฐุง ูุงู ุงูุฑุงูุชุฑ ุนูู ุฎุงุฏู ูููุตูุ ููููู ุชูุฑูุฑ ุนููู ูุฎุตุต:
/*
createTRPCOptionsProxy({
  client: createTRPCClient({
    links: [httpLink({ url: 'https://api.example.com' })], // ุฑุงุจุท HTTP ููุงุชุตุงู ุจุงูุฎุงุฏู ุงูุจุนูุฏ
  }),
  queryClient: getQueryClient, // ุนููู ุงูุงุณุชุนูุงูุงุช ุงููุดุชุฑู
});
*/


// ุฅุฐุง ูุงู ุงูุฑุงูุชุฑ ุนูู ุฎุงุฏู ูููุตูุ ููููู ุชูุฑูุฑ ุนููู ูุฎุตุต:
// createTRPCOptionsProxy({
//   client: createTRPCClient({
//     links: [httpLink({ url: '...' })], // ุฑุงุจุท HTTP ููุงุชุตุงู ุจุงูุฎุงุฏู ุงูุจุนูุฏ
//   }),
//   queryClient: getQueryClient, // ุนููู ุงูุงุณุชุนูุงูุงุช ุงููุดุชุฑู
// });

// ๐ ุดุฑุญ ุงูููุงููู ุงูุฃุณุงุณูุฉ:

// ๐ซ 'server-only':
// - ูุถูู ุฃู ูุฐุง ุงูููู ูุง ูููู ุงุณุชูุฑุงุฏู ูู ุฌุงูุจ ุงูุนููู
// - ูููุน ุชุณุฑุจ ุดููุฑุฉ ุงูุฎุงุฏู ุฅูู ุงููุชุตูุญ
// - ูุญุณู ุฃูุงู ุงูุชุทุจูู

// ๐พ cache ูู React:
// - ูุฎุฒู ุงููุชูุฌุฉ ุฎูุงู ููุณ ุงูุทูุจ (Request)
// - ูุถูู ุฃู ูู ุทูุจ ูุญุตู ุนูู ููุณ ุงููุณุฎุฉ ูู ุนููู ุงูุงุณุชุนูุงูุงุช
// - ูุญุณู ุงูุฃุฏุงุก ุนู ุทุฑูู ููุน ุฅุนุงุฏุฉ ุงูุฅูุดุงุก ุบูุฑ ุงูุถุฑูุฑูุฉ

// ๐๏ธ createTRPCOptionsProxy:
// - ููุดุฆ ููููุงู (proxy) ูุฎูุงุฑุงุช tRPC
// - ูุณูุญ ุจุงุณุชุฎุฏุงู tRPC ุนูู ุฌุงูุจ ุงูุฎุงุฏู
// - ูููุฑ ูุงุฌูุฉ ููุญุฏุฉ ููุงุณุชุนูุงูุงุช ูุงูุทูุฑุงุช

// ๐ ุงูุฑูุงุจุท (Links):
// - httpLink: ุฑุงุจุท HTTP ุนุงุฏู ููุงุชุตุงู ุจุงูุฎุงุฏู
// - ุจุฏูู ุนู httpBatchLink ุนูู ุงูุฎุงุฏู ุญูุซ ูุง ุญุงุฌุฉ ููุชุฌููุน

// ๐ ุณููุงุฑูู ุงูุฎุงุฏู ุงููููุตู:
// - ูููุฏ ุนูุฏูุง ูููู tRPC API ุนูู ูุทุงู (domain) ูุฎุชูู
// - ูุซุงู: API ุนูู api.example.com ูุงูุชุทุจูู ุนูู example.com

// ๐ฏ ููุงุฆุฏ ูุฐุง ุงูุฅุนุฏุงุฏ:

// 1. ุงูุฃุฏุงุก:
//    - ูุดุงุฑูุฉ ุนููู ุงูุงุณุชุนูุงูุงุช ุฎูุงู ููุณ ุงูุทูุจ
//    - ุชูููู ุชูุฑุงุฑ ุฅูุดุงุก ุงูุนููุงุก

// 2. ุงูุฃูุงู:
//    - ููุน ุชุณุฑุจ ุดููุฑุฉ ุงูุฎุงุฏู ุฅูู ุงูุนููู
//    - ุนุฒู ูุงูู ุจูู ุงูุฎุงุฏู ูุงูุนููู

// 3. ุงููุฑููุฉ:
//    - ุฏุนู ูู ูู ุงูุฎุงุฏู ุงููุญูู ูุงูุฎูุงุฏู ุงูุจุนูุฏุฉ
//    - ูุงุฌูุฉ ููุญุฏุฉ ููุงุณุชุฎุฏุงู

// 4. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ:
//    - ุณูุงู ูุฎุตุต ููู ุทูุจ (Request)
//    - ุนุฒู ุงูุจูุงูุงุช ุจูู ุงููุณุชุฎุฏููู

// โ๏ธ ููุงุญุธุงุช ูููุฉ:

// - ูุฐุง ุงูููู ููุงุณุชุฎุฏุงู ุนูู ุงูุฎุงุฏู ููุท (Server Components)
// - ูุง ูููู ุงุณุชุฎุฏุงูู ูู ููููุงุช ุงูุนููู (Client Components)
// - ูุชู ุฅูุดุงุก ุณูุงู ูููุตู ููู ุทูุจ ูุถูุงู ุงูุนุฒู

// - ุนููู ุงูุงุณุชุนูุงูุงุช ูุชู ูุดุงุฑูุชู ุฎูุงู ููุณ ุงูุทูุจ ููุท

// ๐ง ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Server Components:

/*
import { trpc } from '~/trpc/server';

export default async function ServerComponent() {
  // ุงุณุชุฎุฏุงู trpc ุนูู ุงูุฎุงุฏู
  const user = await trpc.user.getById({ id: '123' });
  
  return (
    <div>
      <h1>{user.name}</h1>
    </div>
  );
}
*/

// ๐ ุงููุฑู ุจูู ุงูุฎุงุฏู ูุงูุนููู:

// | ุงูุฎุงุฏู (Server)          | ุงูุนููู (Client)           |
// |--------------------------|---------------------------|
// | ุนููู ุงุณุชุนูุงูุงุช ููู ุทูุจ   | ุนููู ุงุณุชุนูุงูุงุช ูุดุชุฑู      |
// | ุณูุงู ูููุตู ููู ูุณุชุฎุฏู    | ุณูุงู ูุดุชุฑู                |
// | ููุงุณุจ ููุจูุงูุงุช ุงูุญุณุงุณุฉ   | ููุงุณุจ ููุจูุงูุงุช ุงูุนุงูุฉ     |

// ๐ก๏ธ ุงุนุชุจุงุฑุงุช ุงูุฃูุงู:

// 1. ุงููุตุงุฏูุฉ ุนูู ุงูุฎุงุฏู:
//    - ูุฌุจ ูุนุงูุฌุฉ ุงููุตุงุฏูุฉ ูู createTRPCContext
//    - ุงูุชุฃูุฏ ูู ุตูุงุญูุฉ tokens ูุฌูุณุงุช ุงููุณุชุฎุฏููู

// 2. ุงูุชุญูู ูู ุงูุตุญุฉ:
//    - ุงุณุชุฎุฏุงู Zod ููุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฏุฎูุฉ
//    - ููุน ูุฌูุงุช injection

// 3. ุงูุนุฒู:
//    - ุถูุงู ุนุฒู ุงูุจูุงูุงุช ุจูู ุงููุณุชุฎุฏููู
//    - ููุน ุชุณุฑุจ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ

// ๐ก ูุตุงุฆุญ ููุงุณุชุฎุฏุงู:

// 1. ุงุณุชุฎุฏู ูุฐุง ููููููุงุช ุงูุชู ุชุญุชุงุฌ ุจูุงูุงุช ูู ุงูุฎุงุฏู
// 2. ุงุณุชุฎุฏู ุงูุนููู ููููููุงุช ุงูุชูุงุนููุฉ
// 3. ุงุฌูุน ุจูู ุงูุงุซููู ูุฃูุถู ุชุฌุฑุจุฉ ูุณุชุฎุฏู

// - ุนููู ุงูุงุณุชุนูุงูุงุช ูุชู ูุดุงุฑูุชู ุฎูุงู ููุณ ุงูุทูุจ ููุท

