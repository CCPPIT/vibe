// ุงุณุชูุฑุงุฏ ุงููุญุฏุงุช ุงูุถุฑูุฑูุฉ ูู trpc/server
import { initTRPC } from '@trpc/server';
// ุงุณุชูุฑุงุฏ ุฏุงูุฉ cache ูู React ููุฎุงุฏู
import { cache } from 'react';
// ุงุณุชูุฑุงุฏ ููุชุจุฉ superjson ูุชุญููู ุงูุจูุงูุงุช
import superjson from 'superjson';

// ุฏุงูุฉ ูุฅูุดุงุก ุณูุงู tRPC ูุน ุงูุชุฎุฒูู ุงููุคูุช ุฎูุงู ููุณ ุงูุทูุจ
export const createTRPCContext = cache(async () => {
  /**
   * ุงูุณูุงู (Context) ูู tRPC:
   * - ูุญุชูู ุนูู ุจูุงูุงุช ูุชุงุญุฉ ูุฌููุน ุงูุฅุฌุฑุงุกุงุช (procedures)
   * - ูุซู ุจูุงูุงุช ุงููุตุงุฏูุฉุ ูุงุนุฏุฉ ุงูุจูุงูุงุชุ etc.
   * @see: https://trpc.io/docs/server/context
   */
  return { 
    userId: 'user_123' // โ๏ธ ูุฐุง ูุซุงูุ ูู ุงูุชุทุจูู ุงูุญูููู ูุฌุจ ุฅุถุงูุฉ ุงููุตุงุฏูุฉ ุงูุญููููุฉ
  };
});

// ุชุฌูุจ ุชุตุฏูุฑ ูุงุฆู t ุจุงููุงูู
// ูุฃูู ููุณ ูุตูููุง ุจูุง ููู ุงูููุงูุฉ.
// ุนูู ุณุจูู ุงููุซุงูุ ุงุณุชุฎุฏุงู ูุชุบูุฑ t ุดุงุฆุน ูู ููุชุจุงุช i18n.

// ุชููุฆุฉ tRPC ูุน ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ
const t = initTRPC.create({
  /**
   * ูุญูู ุงูุจูุงูุงุช (transformer):
   * - superjson ูุฏุนู ุฃููุงุน ุงูุจูุงูุงุช ุงููุนูุฏุฉ ูุซู Dateุ Mapุ Set
   * - ูุญุงูุธ ุนูู ุฃููุงุน ุงูุจูุงูุงุช ุฃุซูุงุก ุงูุฅุฑุณุงู ุจูู ุงูุฎุงุฏู ูุงูุนููู
   * @see https://trpc.io/docs/server/data-transformers
   */
   transformer: superjson, // ุงุณุชุฎุฏุงู superjson ูุชุญููู ุงูุจูุงูุงุช
});

// ุชุตุฏูุฑ ูุณุงุนุฏุงุช ุงูุฑุงูุชุฑ ูุงูุฅุฌุฑุงุกุงุช ุงูุฃุณุงุณูุฉ

// ูุณุงุนุฏ ูุฅูุดุงุก ุฑุงูุชุฑ tRPC
export const createTRPCRouter = t.router;

// ูุณุงุนุฏ ูุฅูุดุงุก caller (ูุณุชุฏุนู) ููุฑุงูุชุฑ
export const createCallerFactory = t.createCallerFactory;

// ุงูุฅุฌุฑุงุก ุงูุฃุณุงุณู ุงูุฐู ูููู ุชูุณูุนู ุจุงูุฅุฌุฑุงุกุงุช ุงูุฃุฎุฑู (middleware)
export const baseProcedure = t.procedure;

// ๐ ุดุฑุญ ุงูููุงููู ุงูุฃุณุงุณูุฉ:

// ๐๏ธ ุงููููู ุงูุฃุณุงุณู ูู tRPC:

// 1. ุงูุณูุงู (Context):
//    - ุจูุงูุงุช ูุชุงุญุฉ ูุฌููุน ุงูุฅุฌุฑุงุกุงุช
//    - ูุชู ุฅูุดุงุคู ูุฑุฉ ูุงุญุฏุฉ ููู ุทูุจ ุจูุถู cache
//    - ูููู ุฅุถุงูุฉ: ูุตุงุฏูุฉุ ููุงุนุฏ ุจูุงูุงุชุ ุฎุฏูุงุชุ etc.

// 2. ุงููุญูู (Transformer):
//    - superjson: ูุญูู ุงูุจูุงูุงุช ุจุดูู ุฐูู ุจูู ุงูุฎุงุฏู ูุงูุนููู
//    - ูุฏุนู ุฃููุงุน JavaScript ุงููุนูุฏุฉ ุงูุชู ูุง ูุฏุนููุง JSON ุงูุนุงุฏู

// 3. ุงูุฅุฌุฑุงุกุงุช (Procedures):
//    - baseProcedure: ุงูุฅุฌุฑุงุก ุงูุฃุณุงุณู ุงูุฐู ูููู ุชูุณุนุชู
//    - ูููู ุฅุถุงูุฉ: ูุตุงุฏูุฉุ ุชุญูู ูู ุงูุตุญุฉุ ุชุญููู ุงูุจูุงูุงุชุ etc.

// 4. ุงูุฑุงูุชุฑ (Router):
//    - ูุฌูุน ุงูุฅุฌุฑุงุกุงุช ูู ูููู ุดุฌุฑู
//    - ููุธู API ุจุทุฑููุฉ modular

// ๐ฏ ูุซุงู ุนูู ุงูุชูุณูุน:

// import { baseProcedure } from './trpc';
// export const authenticatedProcedure = baseProcedure.use((opts) => {
//   // ุงูุชุญูู ูู ุงููุตุงุฏูุฉ ููุง
//   if (!opts.ctx.userId) {
//     throw new Error('ุบูุฑ ูุตุฑุญ ุจุงูุฏุฎูู');
//   }
//   return opts.next();
// });

// โ๏ธ ููุงุญุธุงุช ูููุฉ:

// - cache: ูุถูู ุฃู ุงูุณูุงู ูููุดุฃ ูุฑุฉ ูุงุญุฏุฉ ููุท ุฎูุงู ููุณ ุงูุทูุจ
// - userId: ูู ุงูุชุทุจูู ุงูุญููููุ ูุฌุจ ุงูุญุตูู ุนููู ูู ุงููุตุงุฏูุฉ (ูุซู JWT)
// - baseProcedure: ูู ููุทุฉ ุงูุจุฏุงูุฉ ูุฅูุดุงุก ุฅุฌุฑุงุกุงุช ูุฎุตุตุฉ

// ๐ง ุงูุงุณุชุฎุฏุงู ุงููุชููุน:

// 1. ุฅูุดุงุก ุฑุงูุชุฑ:
// const appRouter = createTRPCRouter({ ... });

// 2. ุฅูุดุงุก caller:
// const caller = createCallerFactory(appRouter)(createTRPCContext);

// 3. ุงุณุชุฏุนุงุก ุงูุฅุฌุฑุงุกุงุช:
// const result = await caller.user.getById({ id: '123' });