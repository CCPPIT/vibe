// ุงุณุชูุฑุงุฏ ุงูุฏูุงู ูุงููุญุฏุงุช ุงูุถุฑูุฑูุฉ
import {
  defaultShouldDehydrateQuery, // ุงูุฏุงูุฉ ุงูุงูุชุฑุงุถูุฉ ููุชุญูู ูู ุฅููุงููุฉ ุชุฌููู ุงูุงุณุชุนูุงู
  QueryClient, // ุงูุนููู ูุฅุฏุงุฑุฉ ุงุณุชุนูุงูุงุช React Query
} from '@tanstack/react-query';
import superjson from 'superjson'; // ููุชุจุฉ ููุชุนุงูู ูุน ุงูุชุณููู (serialization) ุจุดูู ูุชูุฏู

// ุฏุงูุฉ ูุฅูุดุงุก ูุชูููู ุนููู ุงูุงุณุชุนูุงูุงุช
export function makeQueryClient() {
  // ุฅูุดุงุก ูุชุนูุฏ ุนููู ุงุณุชุนูุงูุงุช ุฌุฏูุฏ ูุน ุฅุนุฏุงุฏุงุช ูุฎุตุตุฉ
  return new QueryClient({
    // ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ููุนููู
    defaultOptions: {
      // ุฅุนุฏุงุฏุงุช ุงูุงุณุชุนูุงูุงุช
      queries: {
        // ููุช ุงูุชูุงุก ุตูุงุญูุฉ ุงูุจูุงูุงุช (ุจุงููููู ุซุงููุฉ) - 30 ุซุงููุฉ
        staleTime: 30 * 1000,
      },
      // ุฅุนุฏุงุฏุงุช ุนูููุฉ ุงูุชุฌููู (ููุชุฎุฒูู ุงููุคูุช ูู SSR)
      dehydrate: {
        // ุงุณุชุฎุฏุงู superjson ูุชุณููู ุงูุจูุงูุงุช (ูุฏุนู ุฃููุงุน ุงูุจูุงูุงุช ุงููุนูุฏุฉ ูุซู Datesุ Mapsุ Sets)
        serializeData: superjson.serialize,
        // ุงูุฏุงูุฉ ุงูุชู ุชุญุฏุฏ ุฅุฐุง ูุงู ูุฌุจ ุชุฌููู ุงูุงุณุชุนูุงู ุฃู ูุง
        shouldDehydrateQuery: (query) =>
          defaultShouldDehydrateQuery(query) || // ุงูุดุฑุท ุงูุงูุชุฑุงุถู ููุชุฌููู
          query.state.status === 'pending', // || ุชุฌููู ุงูุงุณุชุนูุงูุงุช ุงูุชู ูุง ุชุฒุงู ููุฏ ุงูุชูููุฐ (pending)
      },
      // ุฅุนุฏุงุฏุงุช ุนูููุฉ ุฅุนุงุฏุฉ ุงูุชูููู (ููุงุณุชุฑุฌุงุน ูู ุงูุชุฎุฒูู ุงููุคูุช)
      hydrate: {
        // ุงุณุชุฎุฏุงู superjson ูุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช ุงููุณููุฉ ุฅูู ุดูููุง ุงูุฃุตูู
        deserializeData: superjson.deserialize,
      },
    },
  });
}

// ๐ ุดุฑุญ ุงูููุงููู ุงูุฃุณุงุณูุฉ:

// ๐ ุงูุชุฌููู (Dehydration):
// ุนูููุฉ ุชุญููู ุจูุงูุงุช ุงูุงุณุชุนูุงูุงุช ุฅูู ุดูู ูุงุจู ููุชุฎุฒูู (ูุซู JSON)
// ูุงุณุชุฎุฏุงููุง ูู ุงูุชุตููุฑ ูู ุฌุงูุจ ุงูุฎุงุฏู (SSR)

// ๐ง ุฅุนุงุฏุฉ ุงูุชูููู (Hydration):
// ุนูููุฉ ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ุงููุฌููุฉ ุฅูู ุญุงูุชูุง ุงูุฃุตููุฉ
// ุนูู ุฌุงูุจ ุงูุนููู ุจุนุฏ ุงูุชุตููุฑ ูู ุงูุฎุงุฏู

// ๐ staleTime:
// ุงููุฏุฉ ุงูุชู ุชุนุชุจุฑ ุฎูุงููุง ุงูุจูุงูุงุช "ุทุงุฒุฌุฉ" ููุง ุชุญุชุงุฌ ูุฅุนุงุฏุฉ fetch
// ุจุนุฏ ูุฐู ุงููุฏุฉ ุชุตุจุญ ุงูุจูุงูุงุช "stale" ููุฏ ูุชู ุฅุนุงุฏุฉ fetch ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุฑููุฒ ุนูู ุงููููู

// โก superjson:
// ููุชุจุฉ ุชุณูุญ ุจุชุณููู ูุฅุนุงุฏุฉ ุชุญููู ุฃููุงุน JavaScript ุงููุนูุฏุฉ
// ูุซู Dateุ Mapุ Setุ BigIntุ RegExp ูุบูุฑูุง
// ูุงูุชู ูุง ูุฏุนููุง JSON ุงูุนุงุฏู

// ๐ฏ ููุงุฆุฏ ูุฐุง ุงูุฅุนุฏุงุฏ:
// 1. ุชุญุณูู ุฃุฏุงุก ุงูุชุทุจูู ุจุชูููู ุทูุจุงุช ุงูุดุจูุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ
// 2. ุฏุนู ุฃููุงุน ุงูุจูุงูุงุช ุงููุนูุฏุฉ ูู ุงูุชุฎุฒูู ุงููุคูุช
// 3. ุชุญุณูู ุชุฌุฑุจุฉ SSR ุจุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ูู ุงูุฎุงุฏู
// 4. ุงูุชุญูู ูู ูุฏุฉ ุตูุงุญูุฉ ุงูุจูุงูุงุช ููุชุญุฏูุซ ุงูุชููุงุฆู